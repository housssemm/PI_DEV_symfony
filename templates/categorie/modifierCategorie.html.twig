{% block body %}
    <section class="form-section">
        <div class="container d-flex justify-content-center align-items-center min-vh-100">
            <div class="row justify-content-center w-100">
                <div class="col-12 col-lg-10 col-xl-8">
                    <div class="card card-hover border-0 shadow-lg overflow-hidden custom-gradient-bg form-center">
                        <div class="card-body card-content form-container">
                            <!-- En-tête -->
                            <h2 class="card-title text-primary mb-5 display-6 fw-bold text-primary">
                                <i class="bi bi-pencil-square me-2"></i>Modifier la catégorie
                            </h2>

                            <!-- Début du formulaire -->
                            <div class="container">
                                {{ form_start(f, {'attr': {'novalidate': 'novalidate', 'enctype': 'multipart/form-data'}}) }}

                                <!-- Champ Nom de la catégorie -->
                                <div class="mb-5">
                                    <div class="form-floating">
                                        {{ form_label(f.nom, 'Nom de la catégorie :', {'label_attr': {'class': 'fw-bold text-muted small'}}) }}
                                        {{ form_widget(f.nom, {'attr': {
                                            'class': 'form-control form-control-custom form-control-lg border-3 py-3',
                                            'placeholder': ' ' ,
                                            'id': 'nomInput'
                                        }}) }}
                                    </div>
                                    <div style="color: red">
                                        {{ form_errors(f.nom) }}
                                    </div>
                                </div>

                                <!-- Champ Image de la catégorie -->
                                <div class="mb-5">
                                    <div class="form-floating">
                                        {{ form_label(f.imageFile, 'Image:', {'label_attr': {'class': 'fw-bold text-muted small'}}) }}
                                        <div class="input-group">
                                            {{ form_widget(f.imageFile, {'attr': {
                                                'class': 'form-control form-control-custom form-control-lg border-3 py-3',
                                                'id': 'imageInput',
                                                'placeholder': ' '
                                            }}) }}
                                            <span class="input-group-text bg-primary text-white border-primary px-4">
                                                <i class="bi bi-cloud-arrow-up fs-5"></i>
                                            </span>
                                        </div>
                                    </div>
                                    <div style="color: red">
                                        {{ form_errors(f.imageFile) }}
                                    </div>
                                </div>

                                <!-- Prévisualisation de l'image -->
                                <div class="mb-5 text-center position-relative" id="imagePreviewContainer">
                                    {% if categorie.image %}
                                        <div class="image-wrapper position-relative mx-auto" style="max-width: 400px;">
                                            <p class="text-muted mb-3 fst-italic">Image actuelle :</p>
                                            <div class="ratio ratio-16x9 border-3 rounded-4 overflow-hidden shadow">
                                                <img src="{{ asset('img/' ~ categorie.image) }}"
                                                     class="object-fit-cover"
                                                     alt="Image actuelle" />
                                            </div>
                                        </div>
                                    {% else %}
                                        <div class="placeholder-image bg-light rounded-4 p-5 mx-auto" style="max-width: 400px;">
                                            <i class="bi bi-image text-muted fs-1 opacity-50"></i>
                                            <p class="text-muted mt-3 mb-0 small">Aucune image sélectionnée</p>
                                        </div>
                                    {% endif %}
                                </div>

                                <div class="text-center mt-5 d-flex justify-content-center align-items-center">
                                    <button type="submit" class="btn btn-primary btn-lg px-5 py-3 rounded-pill fw-bold text-uppercase shadow-sm hover-effect">
                                        <i class="bi bi-check2-circle me-2"></i>Modifier
                                    </button>
                                </div>

                                {{ form_end(f) }}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const imageInput = document.querySelector("input[type='file']");
            const imagePreviewContainer = document.getElementById("imagePreviewContainer");

            imageInput.addEventListener("change", function(event) {
                const file = event.target.files[0];
                const reader = new FileReader();

                if (file && file.type.includes('image')) {
                    reader.onload = function(e) {
                        // Conserver le contenu de l'image actuelle et ajouter la nouvelle image en dessous.
                        const currentImage = imagePreviewContainer.querySelector('img');

                        if (currentImage) {
                            // Conserver l'élément existant tout en remplaçant le src
                            currentImage.src = e.target.result;
                            currentImage.style.objectFit = 'contain'; // Ajuster l'image à son conteneur
                        } else {
                            // Si aucune image actuelle n'existe, ajouter la nouvelle image
                            imagePreviewContainer.innerHTML = `
                            <div class="image-preview animated-fade-in">
                                <p class="text-success fw-bold mb-3">Nouvelle image sélectionnée :</p>
                                <img src="${e.target.result}"
                                     class="img-thumbnail shadow-sm rounded-3 border-2"
                                     style="max-width: 280px; max-height: 200px; object-fit: contain;"
                                     alt="Prévisualisation" />
                            </div>`;
                        }
                    };
                    reader.readAsDataURL(file);
                } else {
                    imagePreviewContainer.innerHTML = `
                    <div class="alert alert-danger py-2 px-3 rounded-3 d-inline-flex align-items-center">
                        <i class="fa fa-tags"></i>
                        Format de fichier non supporté
                    </div>`;
                }
            });
        });
    </script>


{% endblock %}
