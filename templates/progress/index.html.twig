{% extends 'base.html.twig' %}

{% block title %}Progression de la Communauté
{% endblock %}

{% block body %}
	<div class="progress-container">
		<div class="progress-header">
			<h1>Progression de la Communauté</h1>
			{% if is_granted('ROLE_USER') %}
				<a href="{{ path('app_progress_new') }}" class="btn btn-primary">Partager ma progression</a>
			{% endif %}
		</div>

		{% for message in app.flashes('success') %}
			<div class="alert alert-success">
				{{ message }}
			</div>
		{% endfor %}

		<div class="progress-grid">
			{% for post in progress_posts %}
				<div class="progress-card">
					<div class="progress-card-header">
						<h2>{{ post.title }}</h2>
						<span class="progress-date">{{ post.createdAt|date('d/m/Y') }}</span>
					</div>

					<div class="progress-images">
						{% if post.beforeImage %}
							<div class="progress-image">
								<img src="{{ asset('uploads/progress/' ~ post.beforeImage) }}" alt="Avant">
								<span class="image-label">Avant</span>
							</div>
						{% endif %}
						{% if post.afterImage %}
							<div class="progress-image">
								<img src="{{ asset('uploads/progress/' ~ post.afterImage) }}" alt="Après">
								<span class="image-label">Après</span>
							</div>
						{% endif %}
					</div>

					<div class="progress-stats">
						<div class="stat">
							<span class="stat-label">Poids actuel</span>
							<span class="stat-value">{{ post.currentWeight }}
								kg</span>
						</div>
						<div class="stat">
							<span class="stat-label">Objectif</span>
							<span class="stat-value">{{ post.goalWeight }}
								kg</span>
						</div>
						<div class="stat">
							<span class="stat-label">Progression</span>
							<span class="stat-value">{{ (post.currentWeight - post.goalWeight)|abs }}
								kg</span>
						</div>
					</div>

					<div class="progress-content">
						{{ post.content|nl2br }}
					</div>

					<div class="progress-actions">
						<button class="btn-like" data-post-id="{{ post.id }}">
							<i class="fas fa-heart"></i>
							<span class="likes-count">{{ post.likes }}</span>
						</button>
						<a href="{{ path('app_progress_show', {'id': post.id}) }}" class="btn btn-secondary">Voir plus</a>
					</div>
				</div>
			{% else %}
				<div class="no-progress">
					<p>Aucune progression partagée pour le moment.</p>
					{% if is_granted('ROLE_USER') %}
						<a href="{{ path('app_progress_new') }}" class="btn btn-primary">Être le premier à partager</a>
					{% endif %}
				</div>
			{% endfor %}
		</div>
	</div>
{% endblock %}

{% block stylesheets %}
	{{ parent() }}
	<style>
		.progress-container {
			max-width: 1200px;
			margin: 0 auto;
			padding: 2rem;
		}

		.progress-header {
			display: flex;
			justify-content: space-between;
			align-items: center;
			margin-bottom: 2rem;
		}

		.progress-header h1 {
			color: var(--primary-color);
			font-size: 2.5rem;
			margin: 0;
		}

		.progress-grid {
			display: grid;
			grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
			gap: 2rem;
		}

		.progress-card {
			background: var(--bg-card);
			border-radius: 15px;
			padding: 1.5rem;
			box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
			transition: transform 0.3s ease;
		}

		.progress-card:hover {
			transform: translateY(-5px);
		}

		.progress-card-header {
			display: flex;
			justify-content: space-between;
			align-items: center;
			margin-bottom: 1rem;
		}

		.progress-card-header h2 {
			color: var(--primary-color);
			font-size: 1.5rem;
			margin: 0;
		}

		.progress-date {
			color: var(--text-muted);
			font-size: 0.9rem;
		}

		.progress-images {
			display: grid;
			grid-template-columns: 1fr 1fr;
			gap: 1rem;
			margin-bottom: 1.5rem;
		}

		.progress-image {
			position: relative;
			border-radius: 10px;
			overflow: hidden;
		}

		.progress-image img {
			width: 100%;
			height: 200px;
			object-fit: cover;
		}

		.image-label {
			position: absolute;
			bottom: 0;
			left: 0;
			right: 0;
			background: rgba(0, 0, 0, 0.7);
			color: white;
			padding: 0.5rem;
			text-align: center;
		}

		.progress-stats {
			display: grid;
			grid-template-columns: repeat(3, 1fr);
			gap: 1rem;
			margin-bottom: 1.5rem;
			background: var(--bg-dark);
			padding: 1rem;
			border-radius: 10px;
		}

		.stat {
			text-align: center;
		}

		.stat-label {
			display: block;
			color: var(--text-muted);
			font-size: 0.9rem;
			margin-bottom: 0.3rem;
		}

		.stat-value {
			color: var(--text-light);
			font-size: 1.2rem;
			font-weight: 600;
		}

		.progress-content {
			color: var(--text-light);
			margin-bottom: 1.5rem;
			line-height: 1.6;
		}

		.progress-actions {
			display: flex;
			justify-content: space-between;
			align-items: center;
		}

		.btn-like {
			background: none;
			border: none;
			color: var(--text-muted);
			cursor: pointer;
			display: flex;
			align-items: center;
			gap: 0.5rem;
			transition: color 0.3s ease;
		}

		.btn-like:hover {
			color: var(--primary-color);
		}

		.btn-like i {
			font-size: 1.2rem;
		}

		.no-progress {
			text-align: center;
			padding: 3rem;
			background: var(--bg-card);
			border-radius: 15px;
			color: var(--text-muted);
		}

		.no-progress p {
			margin-bottom: 1.5rem;
			font-size: 1.2rem;
		}

		@media(max-width: 768px) {
			.progress-header {
				flex-direction: column;
				gap: 1rem;
				text-align: center;
			}

			.progress-grid {
				grid-template-columns: 1fr;
			}

			.progress-stats {
				grid-template-columns: 1fr;
			}
		}
	</style>
{% endblock %}

{% block javascripts %}
	{{ parent() }}
	<script>
		document.addEventListener('DOMContentLoaded', function () {
const likeButtons = document.querySelectorAll('.btn-like');

likeButtons.forEach(button => {
button.addEventListener('click', function () {
const postId = this.dataset.postId;
const likesCount = this.querySelector('.likes-count');

fetch (`/progress/${postId}/like`, {
method: 'POST',
headers: {
'X-Requested-With': 'XMLHttpRequest'
}
}).then(response => response.json()).then(data => {
likesCount.textContent = data.likes;
this.classList.add('liked');
}).catch(error => console.error('Error:', error));
});
});
});
	</script>
{% endblock %}
